<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Django duchate</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #111;
  font-family: Arial, sans-serif;
}

canvas {
  width: 100vw;
  height: 100vh;
  display: block;
}

.watermark {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 64px;
  font-weight: bold;
  color: rgba(255,255,255,0.05);
  pointer-events: none;
  user-select: none;
}
</style>
</head>

<body>

<div class="watermark">Django duchate</div>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* ============ IMÁGENES ============ */
const carImg = new Image();
carImg.src = "https://i.imgur.com/xpZ7p8h.png"; // coche top-down

// Fondo pista seguro (enlace Imgur libre)
const roadTrack = new Image();
roadTrack.src = "https://i.imgur.com/XcQ2e3Y.jpeg"; // pista top-down con curvas

/* Partículas de humo */
class Smoke {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.radius = Math.random() * 5 + 5;
    this.alpha = 1;
  }
  update() { this.alpha -= 0.02; this.y -= 0.3; }
  draw() {
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
    ctx.fillStyle = "rgba(200,200,200," + this.alpha + ")";
    ctx.fill();
  }
}
let smokes = [];

/* ============ COCHE ============ */
const car = {
  x: canvas.width / 2,
  y: canvas.height / 2,
  angle: 0,
  speed: 0,
  maxSpeed: 8.84, // ~130 km/h
  drift: 0.99
};

let keys = {};
let score = 0;
let driftCounter = 0;

/* ============ CONTROLES ============ */
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);
document.addEventListener("touchstart", e => {
  if (e.touches[0].clientX < window.innerWidth / 2) keys["ArrowLeft"] = true;
  else keys["ArrowRight"] = true;
});
document.addEventListener("touchend", () => {
  keys["ArrowLeft"] = false;
  keys["ArrowRight"] = false;
});

/* ============ UPDATE ============ */
function update() {
  if (keys["ArrowUp"]) car.speed += 0.15;
  else car.speed *= 0.98;
  car.speed = Math.min(car.speed, car.maxSpeed);

  if (keys["ArrowLeft"]) car.angle -= 0.04;
  if (keys["ArrowRight"]) car.angle += 0.04;

  // Movimiento con derrape
  car.x += Math.cos(car.angle) * car.speed;
  car.y += Math.sin(car.angle) * car.speed;
  car.speed *= car.drift;

  // Partículas de humo
  if ((keys["ArrowLeft"] || keys["ArrowRight"]) && car.speed > 2) {
    smokes.push(new Smoke(car.x - Math.cos(car.angle) * 20, car.y - Math.sin(car.angle) * 20));
    driftCounter += 0.2;
  } else {
    driftCounter *= 0.95;
  }

  // Puntos
  if (driftCounter > 0.1) score += Math.floor(driftCounter);

  // Mantener en pantalla
  if (car.x < 0) car.x = canvas.width;
  if (car.x > canvas.width) car.x = 0;
  if (car.y < 0) car.y = canvas.height;
  if (car.y > canvas.height) car.y = 0;

  smokes.forEach(s => s.update());
  smokes = smokes.filter(s => s.alpha > 0);
}

/* ============ DRAW ============ */
function draw() {
  // Fondo pista
  if (roadTrack.complete) {
    ctx.drawImage(roadTrack, 0, 0, canvas.width, canvas.height);
  } else {
    ctx.fillStyle = "#333";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }

  // Humo
  smokes.forEach(s => s.draw());

  // Coche
  ctx.save();
  ctx.translate(car.x, car.y);
  ctx.rotate(car.angle);
  ctx.drawImage(carImg, -32, -16, 64, 32);
  ctx.restore();

  // HUD
  ctx.fillStyle = "#fff";
  ctx.font = "22px Arial";
  ctx.fillText("Drift points: " + score, 20, 40);
  ctx.fillText("Velocidad: " + Math.floor(car.speed * 20) + " km/h", 20, 70);
}

/* ============ LOOP ============ */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
